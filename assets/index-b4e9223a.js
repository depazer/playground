import{d as A,s as N,e as K,r as O,C as J,o as h,l as E,h as z,a as e,t as a,w as b,j as v,b as t,A as Q,c as y,k as W,F as G,D as X,g as V,T as M,_ as Y}from"./index-652c48a2.js";import{d as Z,b as R,c as L,_ as q,a as ee,k as te,f as se}from"./ForceChart.vue_vue_type_script_setup_true_lang-a8393d9a.js";function I(n){return new Promise((o,s)=>{n.oncomplete=n.onsuccess=()=>o(n.result),n.onabort=n.onerror=()=>s(n.error)})}function H(n,o){const s=indexedDB.open(n);s.onupgradeneeded=()=>s.result.createObjectStore(o);const c=I(s);return(u,_)=>c.then(f=>_(f.transaction(o,u).objectStore(o)))}let j;function B(){return j||(j=H("keyval-store","keyval")),j}function ne(n,o=B()){return o("readonly",s=>I(s.get(n)))}function U(n,o,s=B()){return s("readwrite",c=>(c.put(o,n),I(c.transaction)))}function oe(n,o=B()){return o("readwrite",s=>(s.delete(n),I(s.transaction)))}const C=H("depazer","registry");async function ae(n,o,s){const c=`${n}@${o}`,u=await ne(c,C);if(u){if(u.ttl===void 0)return{data:u,error:void 0};if(u.ttl>Date.now())return{data:u.registry,error:void 0};oe(c,C)}const{data:_,error:f}=await Z(`${s||"https://registry.npmjs.org/"}${n}/${o}`,{headers:{"Content-Type":"application/json"},method:"GET"},{afterFetch({data:l}){return o!==""&&U(`${n}@${l.version}`,l,C),o!==l.version&&U(`${n}@${o}`,{ttl:Date.now()+1e3*60*5,registry:l},C),{data:l}}}).json();return{error:f.value,data:_.value}}const ie={class:"rounded bg-indigo-3 px-1 font-sans text-indigo-8 dark:bg-blue-6 dark:text-blue-2"},ce={class:"flex-grow overflow-auto"},re={class:"select-none mt-2 flex justify-between items-center gap-2"},le={class:"mr-2 font-bold"},de={class:"rounded bg-lime-2 px-1 font-sans text-lime-6 dark:bg-lime-6 dark:text-lime-1"},ue=e("i",{class:"i-uil-location-point",text:"lg lime-7 dark:lime"},null,-1),pe=[ue],_e=["title"],ge=e("i",{class:"i-uil-channel-add",text:"lg indigo"},null,-1),fe=[ge],he=e("i",{class:"i-uil-fidget-spinner",text:"lg orange"},null,-1),ke=[he],me={class:"my-4"},be={class:"select-none font-bold"},ve={class:"my-2"},ye={class:"select-none flex flex-wrap justify-between gap-2"},we={"my-1":""},xe={class:"mr-2 font-bold"},$e={"font-sans":""},Pe={"my-1":""},Se={class:"mr-2 font-bold"},Ce={"font-sans":""},Ne={class:"select-none"},ze={class:"mr-2 font-bold"},Ie={class:"rounded-sm bg-red-1 px-1 font-sans text-red-6 dark:bg-red-1/30 dark:text-red-3"},Ve={class:"my-4 select-none"},je={class:"mr-2 font-bold"},Be={flex:"~ wrap items-start",class:"mt-2 gap-1"},De={flex:"~ wrap col items-start",class:"my-4 gap-1"},Te={class:"select-none font-bold"},Fe={class:"animate-pulse py-4"},Ke=e("span",{class:"mr-2 inline-block h-4 w-1/4 rounded bg-gray"},null,-1),Oe=e("span",{class:"inline-block h-4 w-1/3 rounded bg-gray"},null,-1),We=e("p",{class:"h-4 rounded bg-gray"},null,-1),Ge=e("p",{class:"h-4 w-3/4 rounded bg-gray"},null,-1),Me=e("p",{class:"h-4 rounded bg-gray"},null,-1),Ue=e("p",{class:"h-4 rounded bg-gray"},null,-1),Ae=[Ke,Oe,We,Ge,Me,Ue],Ee=A({__name:"PackageInfo",props:{currentPackage:{},modelValue:{}},emits:["update:modelValue"],setup(n,{emit:o}){const s=n,c=R(),{currentRegistry:u}=N(c),_=L(),{moduleConfig:f}=N(_),{isPackedNode:l,togglePackedNode:w,packSubNodes:x,unPackSubNodes:P}=_,g=K(()=>s.currentPackage.name+"@"+s.currentPackage.version),S=O(!1),p=O();J(async i=>{if(s.currentPackage.name+s.currentPackage.version==="")return;S.value=!0;const{data:r}=await ae(s.currentPackage.name,s.currentPackage.version,u.value);p.value=r;const m=setTimeout(()=>S.value=!1,300);i(()=>clearTimeout(m))});const k=K(()=>{var i,r,m,d,$,D,T,F;return{description:((i=p.value)==null?void 0:i.description)??"无",dist:{size:(m=(r=p.value)==null?void 0:r.dist)!=null&&m.size?(p.value.dist.size/1024).toFixed(2)+"KB":"UNKNOWN",unpackedSize:($=(d=p.value)==null?void 0:d.dist)!=null&&$.unpackedSize?(p.value.dist.unpackedSize/1024).toFixed(2)+"KB":"UNKNOWN"},license:((D=p.value)==null?void 0:D.license)??"UNKNOWN",keywords:((T=p.value)==null?void 0:T.keywords)??[],dependencies:Object.entries(((F=p.value)==null?void 0:F.dependencies)??{})}});return(i,r)=>(h(),E(q,{class:"h-[calc(100vh-8rem)] w-xs"},{header:z(()=>[e("code",ie,a(i.currentPackage.name),1)]),default:z(()=>{var m;return[b(e("section",ce,[e("div",re,[e("div",null,[e("span",le,a(i.$t("packageInfo.version")),1),e("code",de,a(i.currentPackage.version),1)]),e("div",null,[b(e("button",{type:"button",title:"设为根节点",class:"icon-button",onClick:r[0]||(r[0]=d=>o("update:modelValue",t(g)))},pe,512),[[v,i.currentPackage.version.match(/^\d/)&&t(f).rootModule!==t(g)]]),e("button",{type:"button",title:t(l)(t(g))?"展开自身依赖":"收起自身依赖",class:"icon-button",onClick:r[1]||(r[1]=d=>t(w)(t(g)))},[e("i",{class:Q(t(l)(t(g))?"i-uil-plus":"i-uil-link-broken"),text:"lg red dark:red-3"},null,2)],8,_e),e("button",{type:"button",title:"展开子依赖",class:"icon-button",onClick:r[2]||(r[2]=d=>t(P)(t(g)))},fe),e("button",{type:"button",title:"显示一层子依赖",class:"icon-button",onClick:r[3]||(r[3]=d=>t(x)(t(g)))},ke)])]),e("div",me,[e("span",be,a(i.$t("packageInfo.description")),1),e("p",ve,a(t(k).description),1)]),e("div",ye,[e("p",we,[e("span",xe,a(i.$t("packageInfo.size")),1),e("code",$e,a(t(k).dist.size),1)]),e("p",Pe,[e("span",Se,a(i.$t("packageInfo.unpackedSize")),1),e("code",Ce,a(t(k).dist.unpackedSize),1)])]),e("p",Ne,[e("span",ze,a(i.$t("packageInfo.license")),1),e("code",Ie,a((m=t(p))==null?void 0:m.license),1)]),b(e("div",Ve,[e("span",je,a(i.$t("packageInfo.keywords")),1),e("div",Be,[(h(!0),y(G,null,W(t(k).keywords,d=>(h(),y("code",{class:"rounded-sm bg-cyan-1 px-1 font-sans text-cyan-6 dark:bg-cyan-1/30 dark:text-cyan-3",key:d},a(d),1))),128))])],512),[[v,t(k).keywords.length]]),b(e("div",De,[e("span",Te,a(i.$t("packageInfo.dependencies")),1),(h(!0),y(G,null,W(t(k).dependencies,([d,$])=>(h(),y("li",{class:"px-1",key:d+$},a(d)+"@"+a($),1))),128))],512),[[v,t(k).dependencies.length!==0]])],512),[[v,!t(S)]]),b(e("section",Fe,Ae,512),[[v,t(S)]])]}),_:1}))}}),Re={class:"h-100vh w-full overflow-hidden"},Le={key:1,class:"i-svg-spinners-blocks-shuffle-3 absolute left-[calc(50%-3rem)] top-[calc(50%-3rem)] text-8xl"},He={class:"absolute left-4 top-16"},Je=A({__name:"index",setup(n){const{packageInfoCardVisible:o}=N(R()),s=ee(o),c=X({name:"",version:""});function u(x){s(!0),c.version=x.split("@").slice(-1)[0],c.name=x.split("@").slice(0,-1).join("@")}const{graphData:_,moduleConfig:f}=N(L()),{width:l,height:w}=te();return(x,P)=>(h(),y("div",Re,[V(M,{name:"chart"},{default:z(()=>[t(_).nodes.length?(h(),E(se,{key:0,width:t(l),height:t(w),viewBox:`${-t(l)/2} ${-t(w)/2} ${t(l)} ${t(w)}`,onNodeClick:u,graphData:t(_)},null,8,["width","height","viewBox","graphData"])):(h(),y("i",Le))]),_:1}),V(M,{name:"package-info"},{default:z(()=>[b(e("aside",He,[V(Ee,{modelValue:t(f).rootModule,"onUpdate:modelValue":P[0]||(P[0]=g=>t(f).rootModule=g),currentPackage:t(c),onClose:t(s)},null,8,["modelValue","currentPackage","onClose"])],512),[[v,t(o)]])]),_:1})]))}});const Ye=Y(Je,[["__scopeId","data-v-17e368f1"]]);export{Ye as default};
